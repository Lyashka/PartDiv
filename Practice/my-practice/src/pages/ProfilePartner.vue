<template>
  <div>
    <div class="header wdth">
      <div>
        <svg x="0px" y="0px"
             viewBox="0 0 69.8 70" style="enable-background:new 0 0 69.8 70; fill:#023370;" class="head-image"
             xml:space="preserve">
<!--      <style type="text/css">-->

<!--       </style>-->
          <path class="st0" d="M41.1,38.1c0.1,0.9,0.1,2,0.1,4.6c0,2.9,0,4-0.1,5h2.1c-0.1-1-0.1-2.1-0.1-5c0-2.7,0-3.7,0.1-4.6H41.1
           L41.1,38.1z"/>
          <path class="st0" d="M45.1,45.1c0,1.7,1.3,2.7,3.5,2.7c2.3,0,3.6-1,3.6-2.8c0-1.2-0.7-2-1.9-2.4c1-0.4,1.6-1.1,1.6-2.2
           c0-1.6-1.2-2.5-3.2-2.5c-2.1,0-3.4,1-3.4,2.6c0,1,0.6,1.8,1.6,2.2C45.8,43.1,45.1,43.9,45.1,45.1L45.1,45.1z M48.7,38.8
           c0.9,0,1.4,0.7,1.4,1.8c0,1.1-0.5,1.7-1.3,1.7c-0.9,0-1.4-0.7-1.4-1.8C47.3,39.4,47.8,38.8,48.7,38.8L48.7,38.8z M48.7,43.2
           c1,0,1.6,0.7,1.6,2c0,1.2-0.6,1.9-1.6,1.9c-1,0-1.6-0.7-1.6-2C47.1,43.9,47.7,43.2,48.7,43.2L48.7,43.2z"/>
          <path class="st0" d="M53.6,45.1c0,1.7,1.3,2.7,3.5,2.7c2.3,0,3.6-1,3.6-2.8c0-1.2-0.7-2-1.9-2.4c1-0.4,1.6-1.1,1.6-2.2
           c0-1.6-1.2-2.5-3.2-2.5c-2.1,0-3.4,1-3.4,2.6c0,1,0.6,1.8,1.6,2.2C54.3,43.1,53.6,43.9,53.6,45.1L53.6,45.1z M57.2,38.8
           c0.9,0,1.4,0.7,1.4,1.8c0,1.1-0.5,1.7-1.3,1.7c-0.9,0-1.4-0.7-1.4-1.8C55.9,39.4,56.4,38.8,57.2,38.8L57.2,38.8z M57.2,43.2
           c1,0,1.6,0.7,1.6,2c0,1.2-0.6,1.9-1.6,1.9c-1,0-1.6-0.7-1.6-2C55.6,43.9,56.2,43.2,57.2,43.2L57.2,43.2z"/>
          <path class="st0" d="M66.4,41.5c-1.1,0-1.8,0.5-2.2,1c0.1-2.2,0.7-3.7,2.2-3.7c1.2,0,1.9,1.2,1.9,1.2v-1.7c0,0-0.7-0.3-2-0.3
           c-2.4,0-4.2,1.9-4.2,5.2c0,3.3,1.4,4.8,3.7,4.8c2.1,0,3.4-1.3,3.4-3.4C69.2,42.6,68.2,41.5,66.4,41.5L66.4,41.5z M65.9,46.9
           c-1,0-1.6-0.8-1.7-3.4c0.3-0.4,0.9-0.8,1.6-0.8c1,0,1.5,0.7,1.5,2C67.3,46.1,66.8,46.9,65.9,46.9L65.9,46.9z"/>
          <path class="st0" d="M59.6,10.2C46-3.4,23.9-3.4,10.2,10.2C3.6,16.8,0.2,25.4,0,34.1h0c0,0,0,0.1,0,0.1c0,0.4,0,0.7,0,1.1
           c0-0.2,0-0.3,0-0.5c0,3,0.3,6,1.1,9C6,62.5,25,73.7,43.7,68.9c8.8-2.3,15.9-7.7,20.5-14.8h-0.1c-4.2,6-10.4,10.6-18.1,12.6
           c-17,4.4-34.4-5.8-38.9-22.8c-0.8-3.3-1.1-6.5-1-9.7h1.4c-0.1,2.6,0.2,5.3,0.9,7.9c4,15.3,19.6,24.4,34.8,20.5
           c5.6-1.4,10.3-4.5,13.9-8.5h0c-4.6,4.3-10.7,7-17.5,7c-7.3,0-13.9-3.1-18.6-8c-0.1-0.1-0.2-0.2-0.2-0.2c-0.1-0.1-0.2-0.2-0.2-0.3
           C18,49.6,16,46,14.9,41.9c-0.7-2.6-0.9-5.2-0.7-7.8h1.6c-0.1,2.2,0.1,4.4,0.7,6.6c3,11.7,15,18.8,26.7,15.7c2-0.5,3.9-1.3,5.6-2.4
           h-0.4c-2.3,1-4.9,1.6-7.5,1.6c-10.5,0-19-8.5-19-19c0-0.9,0.1-1.7,0.2-2.5h5h20.5h0h6.7l0,0h9.4h6.1l0,0
           C69.6,25.5,66.2,16.8,59.6,10.2L59.6,10.2z M11.1,33.1c0.7-3.5,2.3-6.9,5-9.6c7.2-7.2,19-7.2,26.2,0c1.9,1.9,3.3,4.1,4.1,6.4
           L11.1,33.1L11.1,33.1z M48,20.7c-8.6-8.6-22.4-8.6-31,0c-3.5,3.5-5.5,7.9-6.2,12.5l-5.7,0.5c0.7-5.4,3.1-10.7,7.3-14.8
           c10-10,26.2-10,36.2,0c3,3,5.1,6.5,6.3,10.3l-1.6,0.1C52.2,26.2,50.5,23.2,48,20.7L48,20.7z M61.6,28.6c-1.2-4.8-3.7-9.3-7.5-13.1
           c-11.2-11.2-29.5-11.2-40.7,0c-5.1,5.1-7.8,11.6-8.3,18.2L1.8,34L0,34.1c0.4-7.6,3.5-15,9.3-20.8C21.8,0.8,42,0.8,54.4,13.3
           c4.3,4.3,7.1,9.6,8.4,15.2L61.6,28.6L61.6,28.6z"/>
       </svg>
      </div>
      <div class="hd1" style="display: inline;">Профиль Партнера</div>
      <div class="hd2"><a href="" @click="$router.push('/menu')">Выйти</a></div>
    </div>

    <div class="content wdth index1">
      <div class="cont1">

        <input class="cont1_itm input_hide" v-model="full_name" style=" width: 100%;" >
      </div>
      <input class=" short input_hide" v-model="short_name"  placeholder='"Короткое название:"'>
      <div class="itm">Тип партнера:
        <div style="margin-left: 10px;">{{typePartner}}
          <select v-model="selected" v-show="ShowSelect" class="selection">
            <option disabled value="">Выберите вариант:</option>
            <option>A</option>
          </select>
        </div>
        <button class="change" @click="OpenSelect">Изменить</button>
      </div>
      <div class="itmDev">Направления разработок:
        <div v-for="dev of partnerOfDev" class="itm DoD zIndexMainDirectionOfDevItem">
          <mainDirectionOfDevItem style="margin-left: 10px;" :dev="dev" :key="dev.id" @removeDirectionOfDev="removeDirectionOfDev"></mainDirectionOfDevItem>
        </div>
        <!--      <select v-model="selected" class="selection" style="margin-left: 5px">-->
        <!--        <option disabled value="">Выберите вариант:</option>-->
        <!--        <option>A</option>-->
        <!--      </select>-->
        <div class="plus">
          <button class="agree_bt hv" style="width: 30px; height: 30px" @click="openWindowDirectionsOfDevBox">+</button>
          <directionsOfDevBox v-show="showDirectionsOfDevBox" :directionOfDev="directionOfDev" @newDirectionOfDev="updateNewDirectionOfDev">

          </directionsOfDevBox>
        </div>

      </div>
    </div>

    <div class="content wdth">
      <div class="cont1">Контакты</div>
      <div class="flex_rovv wdth">
        <div class="cont2" style="padding-right: 50px;">
          <div style="font-size: 20px;">Почта</div>
          <input type="email" placeholder="Mail" class="input" v-model="mail">
        </div>
        <div class="cont2">
          <div style="font-size: 20px;">Телефон</div>
          <input type="text" placeholder="" class="input" v-model="phone" >
        </div>
      </div>
    </div>

    <div class="content wdth">
      <div class="flex_rovv wdth">
        <div class="cont2">
          <div style="font-size: 20px;">Адрес</div>
          <input type="text" placeholder="" class="input" v-model="address">
        </div>
      </div>
      <div class="cont2" style="margin-top: 15px;">
        <div style="font-size: 20px;">Сайт</div>
        <input type="text" placeholder="" class="input" v-model="website">
      </div>
    </div>

    <div class="content wdth">
      <div class="flex_rovv wdth">
        <div class="cont2" style="font-size: 20px; display: flex; flex-direction: row; align-items: center;">
          Руководитель организации:
          <input type="text" placeholder="" class="input" style="margin-left: 10px; width: 75%;" v-model="boss">
        </div>
      </div>
<!--      <div class="cont2" style="margin-top: 15px;">-->
<!--        <div style="font-size: 20px;">Контактные лица</div>-->
<!--        <textarea class="txtari" name="" id="" cols="30" rows="10" style="resize: none;" v-model="contacts"></textarea>-->
<!--      </div>-->
    </div>

    <div class="save">
      <button class="save_btn" @click="persist">Сохранить</button>
    </div>
  </div>
</template>

<script>
import axios from "axios";
import DirectionsOfDevBox from "@/components/directionsOfDev/addDirectionOfDev/directionsOfDevBox.vue";
import mainDirectionOfDevItem from "@/components/directionsOfDev/mainDirectionOfDevItem.vue";
export default{
  components: {
    DirectionsOfDevBox,
    mainDirectionOfDevItem
  },
  data() {
  return{
    full_name: '',
    partnerId: '',
    short_name:'',
    mail: '',
    phone: 0,
    address: '',
    website: '',
    boss:'',
    contacts:'',
    typePartner: '',
    partnerOfDev: [],
    partnerData: '',
    ShowSelect: false,
    showDirectionsOfDevBox: false,

    directionOfDev: {},
  }
  },

  methods: {
    removeDirectionOfDev(DirectionOfDev) {
      this.partnerOfDev = []
      this.partnerData.directionsOfDev = this.partnerData.directionsOfDev.filter(d => d.directionID !== DirectionOfDev.directionID)
      this.partnerData.directionsOfDev.forEach(e => {
        this.partnerOfDev.push(e)
      })
    },
    updateNewDirectionOfDev(newDirectionOfDev){
      this.partnerOfDev = []
      this.partnerData.directionsOfDev.push(newDirectionOfDev)
      this.partnerData.directionsOfDev = this.partnerData.directionsOfDev.filter((item, index, self) =>
        index === self.findIndex((t) => (
            item.directionID === t.directionID
        )))
      this.partnerData.directionsOfDev.forEach(e => {
        this.partnerOfDev.push(e)
      })
      this.showDirectionsOfDevBox = false
      console.log(this.partnerData.directionsOfDev)
    },

    openWindowDirectionsOfDevBox(){
      this.showDirectionsOfDevBox = true
      axios.get('http://93.100.110.70:8080/references/directionsOfDev').then(res => {
        this.directionOfDev = res.data
        console.log(this.directionOfDev)
      })
    },

    requestPartnerData() {
      axios.get('http://93.100.110.70:8080/partners/getone',{
        params: {
          partner_id: `${this.partnerId}`
        }
      }).then(res => {
        // console.log(res.data)
        this.partnerData = res.data
        this.short_name = res.data.shortName
        this.full_name = res.data.fullName
        this.mail = res.data.email
        this.phone = res.data.phone
        this.address = res.data.address
        this.website = res.data.website
        this.boss = res.data.director
        this.typePartner = res.data.partnerType.typeName

        console.log(this.partnerData)
        this.partnerData.directionsOfDev.forEach(e => {
          this.partnerOfDev.push(e)
        })
      })
    },

    persist() {
      localStorage.mail = this.mail;
      localStorage.short_name = this.short_name;
      localStorage.phone = this.phone;
      localStorage.address = this.address;
      localStorage.website = this.website;
      localStorage.boss = this.boss;
      localStorage.contacts = this.contacts;
      localStorage.full_name = this.full_name
      localStorage.typePartner = this.typePartner
      localStorage.partnerOfDev = this.partnerOfDev

      this.partnerData.email = localStorage.mail
      this.partnerData.shortName = localStorage.short_name
      this.partnerData.phone = localStorage.phone
      this.partnerData.address = localStorage.address
      this.partnerData.website = localStorage.website
      this.partnerData.director = localStorage.boss
      this.partnerData.fullName = localStorage.full_name
      this.partnerData.shortName = localStorage.short_name
      this.partnerData.partnerType.typeName = localStorage.typePartner

      // Вся работа производится с this.partnerOfDev теперь
      // this.partnerOfDev.forEach(e => {
      //   this.partnerData.directionsOfDev.push(e)
      // })



      console.log(this.partnerData)
      axios.post('http://93.100.110.70:8080/partners/updatePartner',this.partnerData)
    },

    OpenSelect(){
      if(this.ShowSelect === false){
        this.ShowSelect = true

      }
    },
  },

  mounted() {
    this.partnerId = localStorage.getItem('partner_id')
    this.requestPartnerData()
    if (localStorage.mail) {this.mail = localStorage.mail;}
    if (localStorage.phone) {this.phone = localStorage.phone;}
    if (localStorage.short_name) {this.short_name = localStorage.short_name;}
    if (localStorage.address) {this.address = localStorage.address;}
    if (localStorage.website) {this.website = localStorage.website;}
    if (localStorage.boss) {this.boss = localStorage.boss;}
    if (localStorage.contacts) {this.contacts = localStorage.contacts;}
    console.log(this.partnerData)
  },
}
</script>

<style scoped>
*::before,
*::after {
  box-sizing: border-box;

}

* {
  outline: none!important;
}

body {
  line-height: 1.5;
  margin: 0;
  font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;

}
div {
  display: block;
}

ul{
  margin: 0;
}

.wdth{
  max-width: 1120px;
}

.header {
  display: flex;
  height: 60px;
  font-size: 25px;
  color:rgb(0, 0, 0);
  margin-left: auto;
  margin-right: auto;
  margin-top: 20px;
  align-items: center;
}

.head-image {
  display: inline-block;
  height: auto;
  max-width: 100%;
  width: 50px;
}

.hd1{
  display: flex;
  margin-left: 20px;
  width: 100%;
}

.hd2{
  display: flex;

}

.content{
  display: flex;
  flex-direction: column;
  margin-top: 20px;
  margin-left: auto;
  margin-right: auto;
  position: relative;
  background-color:rgb(250, 250, 250);
  border: 1.5px rgba(0, 0, 0, 0.1) solid;
  border-radius:5px;
  padding: 25px;
  box-shadow: 0 1rem 2rem rgba(0,0,0,.10)!important;
  z-index: 1;
}

.cont1{
  display: flex;
  font-size: 25px;
}

.cont2{
  display: flex;
  flex-direction: column;
  width: 100%;
}

.itm{
  display: flex;
  flex-direction: row;
  align-items: center;
  z-index: 2;
}
.itmDev{
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  align-items: center;
}

.DoD{
  padding: 0;
  height: 32px;
  margin-left: 5px;
  border:1px rgba(0, 0, 0, 0.103) solid;
  border-radius: 20px;
}

.pd-50{
  padding-right: 50px;
}

.cont1_itm{
  padding-right: 10px;
}

.short{
  color:rgb(112, 112, 112);
}

.flex_rovv{
  display: flex;
  flex-direction: row;
}

@media (max-width: 700px){.flex_rovv {flex-direction:column;}}
@media (max-width: 700px){.pd-50 {padding-right:0;}}

.change{
  margin-left: 20px;
  border: none;
  background: inherit;
  color: #2064da;

}

.change:hover{
  text-decoration-line:underline;
}

.input_hide{
  border: none;
  background: inherit;
  font-size: 22px;
  height: 30px;
  margin-bottom: 10px;
  min-width: 100px;
  cursor: pointer;
}

.input_hide:focus{
  display: flex;
  font-size: 22px;
  border-radius: 10px;
  border:1px rgba(0, 0, 0, 0.103) solid;
  padding: 10px;
  height: 40px;
  background-color:rgba(255, 255, 255, 0.801);
  box-shadow:0 0 0 2.5px #0368e448;
  border:1px #004497 solid;
  transition: all 0.2s linear;
  animation-direction: normal, reverse;
  cursor: text;
}

.selection{
  font-size: 18px;
  border-radius: 10px;
  border:1px rgba(0, 0, 0, 0.103) solid;
  padding-left: 10px;
  background-color:rgba(255, 255, 255, 0.801);
}

.input{
  display: flex;
  font-size: 22px;
  border-radius: 10px;
  border:1px rgba(0, 0, 0, 0.103) solid;
  padding-left: 10px;
  margin-top: 5px;
  height: 40px;
  background-color:rgba(255, 255, 255, 0.801);
}

.input:focus, .selection:focus{
  box-shadow:0 0 0 2.5px #0368e448;
  border:1px #004497 solid;
  transition: all 0.2s linear;
  animation-direction: normal, reverse;
}

.save{
  display: flex;
  margin-left: auto;
  margin-right: auto;
  max-width: 1120px;
  margin-top: 10px;
  justify-content: flex-end;
  margin-bottom: 25px;
}

.save_btn{
  font-size: 20px;
  background-color:#4582ec;
  color: #fff;
  border: 2px rgba(0, 0, 0, 0.11) solid;
  border-radius: 5px;
  padding: 7px 40px 7px 40px;
  transition: 0.3s;

}

.save_btn:hover{
  background-color:#2064da;
  cursor: pointer;
}

.txtari{
  border:1px rgba(0, 0, 0, 0.103) solid;
  margin-top: 15px;
  border-radius:10px;
  padding: 10px;
}
.plus{
  display: flex;
  flex-direction: row;
  align-items: center;
}

.index1{
  z-index: 2;
}
.zIndexMainDirectionOfDevItem{
  z-index: 0;
}
</style>